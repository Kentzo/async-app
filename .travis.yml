matrix:
  include:
    - os: osx
      language: generic
      before_install:
        - brew update
        - brew install python3
        - virtualenv env -p python3
        - source env/bin/activate
    - os: linux
      language: python
      python: 3.6
    - os: linux
      language: python
      python: 3.6-dev
    - os: linux
      language: python
      python: 3.7-dev
    - os: linux
      language: python
      python: nightly

install:
  - python -m pip install --upgrade pip
  - python -m pip install ".[ci]" -c requirements.txt

script:
  - python setup.py test
  - python setup.py check -srm

after_success:
  - flake8 async_app
  - codecov

deploy:
  provider: pypi
  user: Ilya.Kulakov
  password:
    secure: "Z205gwgY3zhIxEVvW2Rrk128vQ4aXm2hhC9bLF5IkzNXgcjZdvBuX+E/TKkN/+Jw8UJjebU6daPxYRyu5de/ZYEMmsXvUqVWRSfbzX/Ru+dTp+0FaSpuwoh2S74LQTEBJKFF3o48OAn/GsuG8Izmey+UePqWvv4l5s/zdUNEAOa2trqjHgqCs7ulZ+nRjBOGe24N3A7O3RFdoJMCzb5stBGVIcv8NCd27pT3bDImhGHH1bl3aaeybgDltyKb8lPwpZB/8uCIeZhzzmx8ip5HuUkbDmv/gc1A3zn7488l115ESvixiSJ0TJag90H96KNxHZ0yKa1fz2ATWD5tDCij7yhxXTPdiyV253VzdfxKym90e1I4Ztf+ngtx5wHHCcRx1lweRSWbJsjhqQGK4jrDLbqZ2ZNF3F01ytP/LnQwoCBQy2RCgIqQR8DVAZ+VxegD/Nzd019UwsOi8kgHJuqClBdxxzE5NfLFNXDOX/qApTmaKgB2Z9Z70NGr5ElC/r0GLZRT2Es4BlWIN3HKeFUsvhAbY177Qab7ZBpAh1b1Kc1qrI+czBjj0AoanQwbnAMNC7ZX+AD7VPIfSKq88Kh4lQS/Q6Alv2UqL7hl6L42GlGrwo+wDP24AKYS19bwVUphZa5yuDKjFJtM2qkaHHWCudQkayKcaii0H5RBGsvoU+4="
  on:
    tags: true
    branch: master
    python: 3.6